// Prisma schema for Plaid-based finance app

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id        String  @id @default(cuid())
  email     String? @unique
  createdAt DateTime @default(now())

  items     Item[]
}

model Item {
  id                  String   @id @default(cuid())
  userId              String
  user                User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  plaidItemId         String   @unique
  accessToken         String
  institutionId       String?
  transactionsCursor  String?
  createdAt           DateTime @default(now())

  accounts            Account[]
}

model Account {
  id              String   @id @default(cuid())
  itemId          String
  item            Item     @relation(fields: [itemId], references: [id], onDelete: Cascade)
  plaidAccountId  String   @unique
  name            String?
  officialName    String?
  mask            String?
  type            String?
  subtype         String?
  availableBalance Decimal?
  currentBalance   Decimal?
  currency         String?  @default("USD")
  createdAt        DateTime @default(now())

  transactions     Transaction[]
}

model Transaction {
  id                   String   @id @default(cuid())
  accountId            String
  account              Account  @relation(fields: [accountId], references: [id], onDelete: Cascade)
  plaidTransactionId   String   @unique
  name                 String?
  merchantName         String?
  amount               Decimal
  isoCurrencyCode      String?  @default("USD")
  date                 DateTime
  authorizedDate       DateTime?
  pending              Boolean  @default(false)
  category             Json?
  location             Json?
  paymentChannel       String?
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt
}

